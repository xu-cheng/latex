<%= input "./article/article.tex" %>

\RequirePackage{mdframed}
\RequirePackage{needspace}

\newcounter{@reviewer}
\newcounter{@comment}[@reviewer]

\NewDocumentCommand\newreviewer{o}{%
    {
        \large
        \vskip\topskip%
        \needspace{8\baselineskip}
        \refstepcounter{@reviewer}
        \phantomsection%
        \bookmark[dest=\@currentHref,rellevel=1,keeplevel]{Reviewer \arabic{@reviewer}}
        \noindent\bfseries\underline{Reviewer \arabic{@reviewer}\IfValueT{#1}{ #1}}
        \protected@edef\@currentlabelname{Reviewer \arabic{@reviewer}}
        \par
        \vskip\topskip%
    }
}
\NewDocumentEnvironment{comment}{o}{%
    \refstepcounter{@comment}
    \phantomsection%
    \bookmark[dest=\@currentHref,rellevel=2,keeplevel]{Comment \arabic{@comment}\IfValueT{#1}{ #1}}
    \noindent
    R\arabic{@reviewer}.\IfValueTF{#1}{#1}{\arabic{@comment}}:
    \protected@edef\@currentlabelname{R\arabic{@reviewer}.\IfValueTF{#1}{#1}{\arabic{@comment}}}
    \itshape%
}{%
    \par
}
\surroundwithmdframed[
    backgroundcolor=black!8,
    hidealllines=true,
    innertopmargin=\topskip,
    innerbottommargin=\topskip,
    skipabove=0,
    skipbelow=0
]{comment}
\newenvironment{response}{%
    \phantomsection%
    \bookmark[dest=\@currentHref,rellevel=3,keeplevel]{Response}
    \noindent\textbf{Response:}
}{%
    \par
    \vskip\topskip%
}
