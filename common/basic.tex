\RequirePackage[l2tabu, orthodox]{nag}
\RequirePackage{iftex}
\RequirePackage{ifthen}

% Font setting
\RequirePackage{fontspec}
\setmainfont[Ligatures={Common,TeX}]{Tex Gyre Termes}
\setsansfont[Ligatures={Common,TeX}]{Helvetica Neue}
\setmonofont{CMU Typewriter Text}
\defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}

% Paper size setting
\pdfpagewidth=\paperwidth
\pdfpageheight=\paperheight

% Indent of paragraph and skip between paragraphs
\RequirePackage{indentfirst}
\setlength{\parindent}{2em}
\setlength{\parskip}{0pt plus 2pt minus 1pt}

<% if category != :beamer %>
% Color packages
\RequirePackage{color}
\RequirePackage[table]{xcolor}
<% end %>

% hyperref setting
\RequirePackage[unicode]{hyperref}
\definecolor{@hyperreflinkred}{RGB}{128,23,31}
\hypersetup{
  bookmarksnumbered=true,
  bookmarksopen=true,
  bookmarksopenlevel=3,
  colorlinks=true,
  allcolors=@hyperreflinkred,
  pdfinfo={
    Template.name={<%= name %>},
    Template.author={Xu Cheng <xucheng@me.com>},
    Template.category={<%= category.to_s %>},
    Template.date={<%= date %>},
    Template.commit={<%= commit %>},
    Template.url={https://github.com/xu-cheng/latex},
  },
<% if category == :beamer -%>
  pdfcenterwindow=true,
  pdfstartview={Fit},
  pdfpagemode={FullScreen},
  pdfpagelayout={SinglePage}
<% else -%>
  linktoc=page,
  plainpages=false,
  pdfpagelabels=true,
  pdfstartview={XYZ null null 1},
  pdfpagemode={UseOutlines},
  pdfpagelayout={OneColumn}
<% end -%>
}

% Math related packages
\RequirePackage{amsmath,amssymb,amsfonts,mathrsfs,latexsym}
<% if category != :beamer %>
\RequirePackage{bm}
<% end %>
\RequirePackage[amsmath,amsthm,hyperref,thref]{ntheorem}
\RequirePackage{fancynum}
\setfnumgsym{\,}
\RequirePackage[lined,boxed,linesnumbered,ruled,vlined,algosection]{algorithm2e}

% Picture related packages
\RequirePackage[all]{xy}
\RequirePackage{overpic}
\RequirePackage{graphicx,caption,subcaption}

% Table related packages
\RequirePackage{array}
\RequirePackage{tabu}
\RequirePackage{booktabs}
\RequirePackage{multirow}
\newcommand{\tabincell}[2]{\begin{tabular}{@{}#1@{}}#2\end{tabular}}

% Load packages
\RequirePackage{etoolbox}
\RequirePackage{datenumber}

% Equation style
\allowdisplaybreaks[4]
\numberwithin{equation}{<%= top_level %>}

% Skip between equation and context
\abovedisplayskip=10bp plus 2bp minus 2bp
\abovedisplayshortskip=10bp plus 2bp minus 2bp
\belowdisplayskip=\abovedisplayskip
\belowdisplayshortskip=\abovedisplayshortskip

% Theorem style
\theoremnumbering{arabic}
\theoremseparator{:}
\theorempreskip{1.2ex plus 0ex minus 1ex}
\theorempostskip{1.2ex plus 0ex minus 1ex}
\theoremheaderfont{\normalfont\bfseries}
\theoremsymbol{}
\def\proofname{\textbf{Proof}}
\theoremstyle{definition}
\newtheorem{definition}{Definition}[<%= top_level %>]
\newtheorem{proposition}{Proposition}[<%= top_level %>]
\newtheorem{lemma}{Lemma}[<%= top_level %>]
\newtheorem{theorem}{Theorem}[<%= top_level %>]
\newtheorem{axiom}{Axiom}[<%= top_level %>]
\newtheorem{corollary}{Corollary}[<%= top_level %>]
\newtheorem{exercise}{Exercise}[<%= top_level %>]
\newtheorem{example}{Example}[<%= top_level %>]

% Floating objects style
\setlength{\intextsep}{0.7\baselineskip plus 0.1\baselineskip minus 0.1\baselineskip}
\setlength{\textfloatsep}{0.8\baselineskip plus 0.1\baselineskip minus 0.2\baselineskip}
\renewcommand{\textfraction}{0.15}
\renewcommand{\topfraction}{0.85}
\renewcommand{\bottomfraction}{0.65}
\renewcommand{\floatpagefraction}{0.60}

% Caption style
\DeclareCaptionLabelFormat{@caplabel}{#1~#2}
\captionsetup{
<% if category == :beamer -%>
  compatibility=false,
<% end -%>
  labelformat=@caplabel,
  format=hang,
  labelsep=quad,
  skip=\baselineskip
}

% Utility function
\def\email#1{
  \href{mailto:#1}{\texttt{#1}}
}
