% Check for obsoleted LaTeX packages
\RequirePackage[l2tabu,orthodox]{nag}

% Utility packages
\RequirePackage{datenumber}
\RequirePackage{etoolbox}
\RequirePackage{iftex}
<% if category != :poster %>
\RequirePackage{ragged2e}
<% end %>
\RequirePackage{xparse}
\RequirePackage{xpatch}
\RequirePackage{xstring}

% Font setting
\ifLuaTeX%
    \RequirePackage{fontspec}
    \setmainfont[Ligatures={Common,TeX}]{Tex Gyre Termes}
    \setsansfont[Ligatures={Common,TeX}]{Helvetica Neue}
    \setmonofont{CMU Typewriter Text}
    \defaultfontfeatures{Scale=MatchLowercase}
\else%
    \RequirePackage{newtxtext}
    \RequirePackage[T1]{fontenc}
    \RequirePackage{textcomp}
\fi%

% Paper size setting
\ifthenelse{\isnamedefined{pagewidth}}{
    \pagewidth=\paperwidth%
    \pageheight=\paperheight%
}{
    \ifthenelse{\isnamedefined{pdfpagewidth}}{
        \pdfpagewidth=\paperwidth%
        \pdfpageheight=\paperheight%
    }{}
}

% Indent of paragraph and skip between paragraphs
\RequirePackage{indentfirst}
\setlength{\parindent}{2em}
\setlength{\parskip}{0pt plus 2pt}

% Color packages
\RequirePackage{color}
\RequirePackage[table,dvipsnames]{xcolor}

% hyperref setting
\RequirePackage[unicode]{hyperref}
\definecolor{@hyperreflinkred}{RGB}{128,23,31}
\hypersetup{
    bookmarksnumbered=true,
    bookmarksopen=true,
    bookmarksopenlevel=3,
    colorlinks=true,
    allcolors=@hyperreflinkred,
<% if name !~ /reviewresponse/ %>
    pdfinfo={
        Template.name={<%= name %>},
        Template.author={Xu Cheng <xucheng@me.com>},
        Template.category={<%= category.to_s %>},
        Template.date={<%= date %>}, % chktex 8
        Template.commit={<%= commit %>},
        Template.url={https://github.com/xu-cheng/latex},
    },
<% end %>
<% if category == :beamer %>
    pdfcenterwindow=true,
    pdfstartview={Fit},
    pdfpagemode={FullScreen},
    pdfpagelayout={SinglePage}
<% elsif category == :poster %>
    plainpages=false,
    pdfcenterwindow=true,
    pdfstartview={Fit},
    pdfpagemode={UseNone},
    pdfpagelayout={SinglePage}
<% else %>
    linktoc=page,
    plainpages=false,
    pdfstartview={XYZ null null 1},
    pdfpagemode={UseOutlines},
    pdfpagelayout={OneColumn}
<% end %>
}
\RequirePackage{bookmark}

% Math related packages
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsfonts}
\RequirePackage{mathrsfs}
\RequirePackage{latexsym}
<% if category != :beamer %>
\RequirePackage{bm}
<% end %>
\RequirePackage{fancynum}
\setfnumgsym{\,}
\RequirePackage[ruled,vlined]{algorithm2e}
\SetVlineSkip{0pt}

<% if category != :beamer %>
% Caption related packages
\RequirePackage{caption}
\RequirePackage{subcaption}
<% end %>

% Figure related packages
\RequirePackage{graphicx}
\RequirePackage{tikz}
\RequirePackage{overpic}

% Table related packages
\RequirePackage{array}
\RequirePackage{tabu}
\RequirePackage{booktabs}
\RequirePackage{multirow}
\RequirePackage{makecell}

% Equation style
\allowdisplaybreaks[4]
\numberwithin{equation}{<%= top_level %>}

% Skip between equation and context
% Ref: https://tex.stackexchange.com/a/69678
\def\@setdisplayskip{
    \abovedisplayskip=0.75\baselineskip plus 0.15\baselineskip minus 0.45\baselineskip % chktex 1
    \abovedisplayshortskip=0pt plus 0.25\baselineskip % chktex 1
    \belowdisplayskip=0.75\baselineskip plus 0.15\baselineskip minus 0.45\baselineskip % chktex 1
    \belowdisplayshortskip=0.5\baselineskip plus 0.25\baselineskip minus 0.25\baselineskip % chktex 1
}
\xapptocmd\Huge{\@setdisplayskip}{}{}
\xapptocmd\huge{\@setdisplayskip}{}{}
\xapptocmd\LARGE{\@setdisplayskip}{}{}
\xapptocmd\Large{\@setdisplayskip}{}{}
\xapptocmd\large{\@setdisplayskip}{}{}
\xapptocmd\normalsize{\@setdisplayskip}{}{}
\xapptocmd\small{\@setdisplayskip}{}{}
\xapptocmd\footnotesize{\@setdisplayskip}{}{}
\xapptocmd\scriptsize{\@setdisplayskip}{}{}
\xapptocmd\tiny{\@setdisplayskip}{}{}

<% if category != :beamer %>
% Caption style
\DeclareCaptionLabelFormat{@caplabel}{#1~#2}
\captionsetup{
    labelformat=@caplabel,
    format=hang,
    labelsep=quad,
    skip=0.5\baselineskip plus 0.25\baselineskip minus 0.25\baselineskip% chktex 1
}
<% end %>

% Utility function
\RequirePackage{soul} % offers \hl
\def\email#1{
    \href{mailto:#1}{\texttt{#1}}
}
\long\def\eat#1{}
\long\def\todo#1{
    {\color{red} TODO:\ #1}
}
