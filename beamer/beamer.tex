<%= license %>

\NeedsTeXFormat{LaTeX2e}[1999/12/01]
\ProvidesClass{<%= name %>}
\DeclareOption*{\PassOptionsToClass{\CurrentOption}{beamer}}
\ProcessOptions%
\LoadClass[utf8,compress,xcolor={table,dvipsnames}]{beamer}

<%= input "./common/basic.tex" %>

% Theorem style
\setbeamertemplate{theorems}[numbered]

% Variables Setting
\let\@oldtitle\title%
\DeclareDocumentCommand\title{o +m}
{
    \IfNoValueTF{#1}{
        \@oldtitle{#2}
    }{
        \@oldtitle[#1]{#2}
    }
    \hypersetup{pdftitle={#2}}
}
\title{}

\let\@oldauthor\author%
\DeclareDocumentCommand\author{o +m}
{
    \IfNoValueTF{#1}{
        \@oldauthor{#2}
        \hypersetup{pdfauthor={#2}}
    }{
        \@oldauthor[#1]{#2}
        \hypersetup{pdfauthor={#1}}
    }
}
\author{}

\let\@olddate\date%
\DeclareDocumentCommand\date{m g g}
{
    \IfNoValueTF{#2}{
        \@olddate{#1} % only one argument
    }{
        \IfNoValueTF{#3}{ % two arguments
            \setdate{#1}{#2}{1}
            \@olddate{\datemonthname~\thedateyear}
        }{  % three arguments
            \setdate{#1}{#2}{#3}
            \@olddate{\datedate}
        }
    }
}
\setdatetoday%
\date{\thedateyear}{\thedatemonth}{\thedateday}

% Beamer style
\newdimen\beamer@headheight
\beamer@headheight=0.13\paperwidth%
\usetheme{Boadilla}
\usecolortheme{sidebartab}
\usefonttheme[onlymath]{serif}
\setbeamerfont{date}{size=\scriptsize,parent=sidebartab}
\setbeamerfont{section in head/foot}{size=\tiny,series=\normalfont}
\setbeamerfont{frametitle}{size=\Large,series=\bfseries}
\setbeamertemplate{itemize items}[circle]
\setbeamertemplate{enumerate items}[default]
\setbeamertemplate{blocks}[rounded][shadow=true]
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]
\defbeamertemplate{subsubsection in toc}{subsubsections numbered}
{
    \leavevmode\leftskip=3em%
    \rlap{\hskip-3em\inserttocsectionnumber.\inserttocsubsectionnumber.\inserttocsubsubsectionnumber}%
    \inserttocsubsubsection\par
}
\setbeamertemplate{subsubsection in toc}[subsubsections numbered]
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{footline}
{
    \linethickness{0pt}
    \framelatex{
        \begin{beamercolorbox}[leftskip=.3cm,wd=\paperwidth,ht=0.3\beamer@headheight,sep=0.1cm]{Location bar}
            \usebeamerfont{section in head/foot}%
            \insertshortauthor~|~\insertshorttitle%
            \hfill
            \insertframenumber/\inserttotalframenumber%
        \end{beamercolorbox}}
}

% Beamer title
\def\maketitle{
    \begingroup
    \setbeamertemplate{footline}
    {
        \linethickness{0pt}
        \framelatex{
            \begin{beamercolorbox}[leftskip=.3cm,wd=\paperwidth,ht=0.3\beamer@headheight,sep=0.1cm]{Location bar}
                \usebeamerfont{section in head/foot}%
                \insertshortauthor~|~\insertshorttitle%
                \hfill
            \end{beamercolorbox}}
    }
    \begin{frame}
        \thispdfpagelabel{Title}
        \hypersetup{pageanchor=false}
        \titlepage
    \end{frame}
    \endgroup
    \setcounter{framenumber}{0}
}

% Beamer TOC
\def\PrintTOC{
    \begin{frame}{\contentsname}
        \bookmark[page=\thepage,level=3]\expandafter{\contentsname}
        \tableofcontents[subsectionstyle=hide]
    \end{frame}
}

\newif\if@TOCAtBeginSection
\@TOCAtBeginSectiontrue

\def\EnableTOCAtBeginSection{\@TOCAtBeginSectiontrue}
\def\DisableTOCAtBeginSection{\@TOCAtBeginSectionfalse}

\AtBeginSection[] {
    \if@TOCAtBeginSection
        \begin{frame}{\secname}
            \tableofcontents[sectionstyle=show/shaded,subsectionstyle=hide,subsubsectionstyle=hide]
        \end{frame}
    \else\fi
}

\AtBeginSubsection[] {
    \if@TOCAtBeginSection
        \begin{frame}{\secname}{\subsecname}
            \tableofcontents[sectionstyle=show/hide,subsectionstyle=show/shaded/hide,subsubsectionstyle=hide]
        \end{frame}
    \else\fi
}

% Justify text inside list environment
% Ref: http://liam0205.me/2017/04/11/justifying-in-beamer-s-lists/
\xpatchcmd{\itemize}{\raggedright}{\justifying}{}{}
\xpatchcmd{\beamer@enum@}{\raggedright}{\justifying}{}{}
\xpatchcmd{\@@description}{\raggedright}{\justifying}{}{}
