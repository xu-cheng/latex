<%= input "./common/head.tex" %>

\newif\if@biblatex
\@biblatexfalse
\DeclareOptionX{biblatex}[]{
    \@biblatextrue
    \ifthenelse{\equal{#1}{}}{
        \PassOptionsToPackage{style=ieee-alphabetic,giveninits=true,maxbibnames=10,dashed=false}{biblatex}
    }{
        \PassOptionsToPackage{#1}{biblatex}
    }
}

\DeclareOptionX*{\PassOptionsToClass{\CurrentOption}{beamer}}
\ProcessOptionsX%
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{table,dvipsnames}{xcolor}
\LoadClass[compress,xcolor]{beamer}

<%= input "./common/basic.tex" %>

% Justify text inside list environment
% Ref: http://liam0205.me/2017/04/11/justifying-in-beamer-s-lists/
\xpatchcmd{\itemize}{\raggedright}{\justifying}{}{}
\xpatchcmd{\beamer@enum@}{\raggedright}{\justifying}{}{}
\xpatchcmd{\@@description}{\raggedright}{\justifying}{}{}

% Theorem style
\setbeamertemplate{theorems}[numbered]

% Variables Setting
\let\@olddate\date%
\DeclareDocumentCommand\date{o m g g}
{
    \IfNoValueTF{#3}{
        % only one argument
        \gdef\@date{#2}
    }{
        \IfNoValueTF{#4}{ % two arguments
            \setdate{#2}{#3}{1}
            \gdef\@date{\datemonthname~\thedateyear}
        }{  % three arguments
            \setdate{#2}{#3}{#4}
            \gdef\@date{\datedate}
        }
    }
    \IfValueTF{#1}{\@olddate[#1]{\@date}}{\@olddate{\@date}}
}
\setdatetoday%
\date{\thedateyear}{\thedatemonth}{\thedateday}

% Beamer style
\newdimen\beamer@headheight
\beamer@headheight=0.13\paperwidth%
\usetheme{Boadilla}
\usecolortheme{sidebartab}
\usefonttheme[onlymath]{serif}
\setbeamerfont{date}{size=\scriptsize,parent=sidebartab}
\setbeamerfont{section in head/foot}{size=\tiny,series=\normalfont}
\setbeamerfont{frametitle}{size=\Large,series=\bfseries}
\setbeamertemplate{itemize items}[circle]
\setbeamertemplate{enumerate items}[default]
\setbeamertemplate{blocks}[rounded][shadow=true]
\setbeamerfont{block title}{size=\small}
\setbeamerfont{block}{size=\small}
\setbeamertemplate{caption}[numbered]
\setbeamerfont{caption}{size=\scriptsize}
\setbeamercolor{alerted text}{use=structure,fg=structure.fg}
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]
\defbeamertemplate{subsubsection in toc}{subsubsections numbered}
{
    \leavevmode\leftskip=3em%
    \rlap{\hskip-3em\inserttocsectionnumber.\inserttocsubsectionnumber.\inserttocsubsubsectionnumber}%
    \inserttocsubsubsection\par
}
\setbeamertemplate{subsubsection in toc}[subsubsections numbered]
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{footline}
{
    \linethickness{0pt}
    \framelatex{
        \begin{beamercolorbox}[leftskip=.3cm,wd=\paperwidth,ht=0.3\beamer@headheight,sep=0.1cm]{Location bar}
            \usebeamerfont{section in head/foot}%
            \insertshortauthor~|~\insertshorttitle%
            \hfill
            \insertframenumber/\inserttotalframenumber%
        \end{beamercolorbox}}
}
\hypersetup{allcolors=structure.fg}

% Beamer title
\DeclareDocumentCommand\maketitle{}{
    \begingroup
    \setbeamertemplate{footline}
    {
        \linethickness{0pt}
        \framelatex{
            \begin{beamercolorbox}[leftskip=.3cm,wd=\paperwidth,ht=0.3\beamer@headheight,sep=0.1cm]{Location bar}
                \usebeamerfont{section in head/foot}%
                \insertshortauthor~|~\insertshorttitle%
                \hfill
            \end{beamercolorbox}}
    }
    \begin{frame}
        \thispdfpagelabel{Title}
        \hypersetup{pageanchor=false}
        \titlepage
    \end{frame}
    \endgroup
    \setcounter{framenumber}{0}
}

% Beamer TOC
\newcommand{\PrintTOC}{
    \begin{frame}{\contentsname}
        \bookmark[page=\thepage,level=3]{\contentsname}
        \tableofcontents[subsectionstyle=hide]
    \end{frame}
}

\newif\if@TOCAtBeginSection
\@TOCAtBeginSectiontrue

\newcommand{\EnableTOCAtBeginSection}{\@TOCAtBeginSectiontrue}
\newcommand{\DisableTOCAtBeginSection}{\@TOCAtBeginSectionfalse}

\AtBeginSection[] {
    \if@TOCAtBeginSection
        \begin{frame}{\secname}
            \tableofcontents[sectionstyle=show/shaded,subsectionstyle=hide,subsubsectionstyle=hide]
        \end{frame}
    \else\fi
}

\AtBeginSubsection[] {
    \if@TOCAtBeginSection
        \begin{frame}{\secname}{\subsecname}
            \tableofcontents[sectionstyle=show/hide,subsectionstyle=show/shaded/hide,subsubsectionstyle=hide]
        \end{frame}
    \else\fi
}

% Bibliography
\if@biblatex
    \RequirePackage{biblatex}
    \newcommand{\PrintRef}{
        \begingroup
        \setbeamertemplate{frametitle continuation}{}
        \begin{frame}[t,allowframebreaks]{\refname}
            \bookmark[page=\thepage,startatroot]{\refname}
            \setbeamertemplate{bibliography item}[text]
            \renewcommand*{\bibfont}{\scriptsize}
            \printbibliography%
        \end{frame}
        \endgroup
    }
\fi

% Thanks Q&A page
\newcommand{\PrintQA}{
    \begin{frame}
        \Huge\centering
        Thanks \\[1ex]
        Q\&A
    \end{frame}
}
